# 3 ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ë£¨ëŠ” í‘œì¤€ ì•„í‚¤í…ì³, ì¿ ë²„ë„¤í‹°ìŠ¤

## ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ í™˜ê²½

> ë¦¬ëˆ…ìŠ¤ ìš´ì˜ ì²´ì œì˜ ì»¤ë„ í•˜ë‚˜ì—ì„œ ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆê°€ ê²©ë¦¬ëœ ìƒíƒœë¡œ ì‹¤í–‰ë˜ëŠ” ì¸í”„ë¼ í™˜ê²½

<img src="https://user-images.githubusercontent.com/101400894/229276684-13e8707c-b101-4bea-ba53-637f713139af.png" alt="image" style="zoom:50%;" align="left"/><img src="https://user-images.githubusercontent.com/101400894/229276762-c430974f-cfee-4152-806c-90c0bec540a2.png" alt="image" style="zoom:50%;" />



+ ê°€ìƒí™” í™˜ê²½
  + ê°ê°ì˜ ê°€ìƒë¨¸ì‹ ì´ ëª¨ë‘ ë…ë¦½ì ì¸ ìš´ì˜ì²´ì œì»¤ë„ì„ ê°€ì§€ê³  ìˆìŒ
+ ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ í™˜ê²½
  + ìš´ì˜ì²´ì œ ì»¤ë„ í•˜ë‚˜ì— ì»¨í…Œì´ë„ˆ ì—¬ëŸ¬ê°œê°€ ê²©ë¦¬ëœ í˜•íƒœë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ìì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©, ê±°ì¹˜ëŠ” ë‹¨ê³„ê°€ ì ìŒ
  + ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ í™˜ê²½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬



## ì¿ ë²„ë„¤í‹°ìŠ¤

> **ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**ì„ ìœ„í•œ ì†”ë£¨ì…˜

+ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ : ë³µì¡í•œ ë‹¨ê³„ë¥¼ ê´€ë¦¬í•˜ê³  ìš”ì†Œë“¤ì˜ ìœ ê¸°ì ì¸ ê´€ê³„ë¥¼ ë¯¸ë¦¬ ì •ì˜í•´ ì†ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„œë¹„ìŠ¤ ì œê³µ
  + ë‹¤ìˆ˜ì˜ ì»¨í…Œì´ë„ˆë¥¼ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°, ì‹¤í–‰, ì¢…ë£Œí•  ë¿ë§Œ ì•„ë‹ˆë¼ ìƒíƒœë¥¼ ì¶”ì í•˜ê³  ë³´ì¡´
  + ì»¨í…Œì´ë„ˆë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒ



ğŸ“Œ k8s = ì¿ ë²„ë„¤í‹°ìŠ¤



### ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì„± ë°©ë²•

1. í¼ë¸”ë¦­ í´ë¼ìš°ë“œ ì—…ì²´ì—ì„œ ì œê³µí•˜ëŠ” ê´€ë¦¬í˜• ì¿ ë²„ë„¤í‹°ìŠ¤(EKS, AKS, GKE ë“±)
   + êµ¬ì„±ì´ ì´ë¯¸ ë‹¤ ê°–ì¶°ì ¸ìˆê³  ë§ˆìŠ¤í„° ë…¸ë“œë¥¼ í´ë¼ìš°ë“œ ì—…ì²´ì—ì„œ ê´€ë¦¬í•˜ê¸°ì— í•™ìŠµìš©ìœ¼ë¡œ ì í•© X

2. ìˆ˜ì„¸ì˜ Rancher, ë ˆë“œí–‡ì˜ OpenShiftì™€ ê°™ì€ í”Œë«í¼ì—ì„œ ì œê³µí•˜ëŠ” ì„¤ì¹˜í˜• ì¿ ë²„ë„¤í‹°ìŠ¤(ìœ ë£Œ)
3. ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì— ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì„±í•´ì£¼ëŠ” ì†”ë£¨ì…˜
   + kubeadm, kops, KRIB, kubespray
   + kubeadmì€ ì‚¬ìš©ìê°€ ë³€ê²½í•˜ê¸° ìˆ˜ì›”, ì˜¨í”„ë ˆë¯¸ìŠ¤ì™€ í´ë¼ìš°ë“œë¥¼ ëª¨ë‘ ì§€ì›



#### ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì„±í•˜ê¸°

ìš°ì„  **ë² ì´ê·¸ëŸ°íŠ¸ë¥¼ ì´ìš©í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤í–‰í™˜ê²½ êµ¬ì¶•**

```
vagrant up

kubectl get nodes : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ë§ˆìŠ¤í„° ë…¸ë“œì™€ ì›Œì»¤ ë…¸ë“œë“¤ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ê³  ì—°ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸
```



+ ê°€ìƒë¨¸ì‹ ì„ **í”„ë¡œë¹„ì €ë‹(provisioning)** í•œë‹¤ëŠ” ê²ƒì€, **ê°€ìƒë¨¸ì‹ ì„ ìƒì„±í•˜ê³  í•„ìš”í•œ ë¦¬ì†ŒìŠ¤(CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ë“±)ë¥¼ í• ë‹¹**í•˜ë©°, **ìš´ì˜ ì²´ì œì™€ í•„ìš”í•œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì„¤ì¹˜í•˜ê³  ì„¤ì •í•˜ëŠ” ì¼ë ¨ì˜ ê³¼ì •**ì„ ë§í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê°€ìƒë¨¸ì‹ ì´ ì¤€ë¹„ë˜ì–´ ì‘ì—…ì„ ìˆ˜í–‰í•  ì¤€ë¹„ê°€ ì™„ë£Œë©ë‹ˆë‹¤. 
  + **ê°€ìƒë¨¸ì‹ ì„ í”„ë¡œë¹„ì €ë‹** í•˜ëŠ” ì´ìœ ëŠ”, ë¬¼ë¦¬ì ì¸ ì„œë²„ì™€ëŠ” ë‹¬ë¦¬ **ì‰½ê²Œ ìƒì„±í•˜ê³  ì‚­ì œ**í•  ìˆ˜ ìˆìœ¼ë©°, í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ìœ ì—°í•˜ê²Œ í• ë‹¹í•˜ì—¬ ë¹„ìš©ì„ ì ˆê°í•˜ê³ , ë¹ ë¥´ê²Œ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  + ê°€ìƒë¨¸ì‹  í”„ë¡œë¹„ì €ë‹ì—ì„œ ì¤‘ìš”í•œ ìš”ì†ŒëŠ”, **ê°€ìƒë¨¸ì‹ ì˜ í¬ê¸°ì™€ êµ¬ì„±, ìš´ì˜ ì²´ì œ, ë„¤íŠ¸ì›Œí¬ êµ¬ì„±, ë³´ì•ˆ ì„¤ì •** ë“±ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ìš”ì†Œë“¤ì„ ì‹ ì¤‘í•˜ê²Œ ì„ íƒí•˜ê³  ì„¤ì •í•´ì•¼, ì•ˆì •ì ì¸ ìš´ì˜ê³¼ ìµœì ì˜ ì„±ëŠ¥ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    + ê°€ìƒë¨¸ì‹  í”„ë¡œë¹„ì €ë‹ì—ì„œ **ìë™í™”**ëŠ”, **ê°€ìƒë¨¸ì‹  ìƒì„±, ë¦¬ì†ŒìŠ¤ í• ë‹¹, ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì¹˜ ë° ì„¤ì • ë“±ì„ ìë™í™”**í•˜ì—¬, íš¨ìœ¨ì ì´ê³  ì¼ê´€ëœ ì¸í”„ë¼ êµ¬ì„±ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì¸ë ¥ê³¼ ë¹„ìš©ì„ ì ˆê°í•  ìˆ˜ ìˆìœ¼ë©°, ì¸í”„ë¼ì˜ í™•ì¥ì„±ê³¼ ìœ ì—°ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    + í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ê°€ìƒë¨¸ì‹  í”„ë¡œë¹„ì €ë‹ê³¼ ê´€ë ¨ëœ ì´ìŠˆëŠ”, **ë†’ì€ ê°€ìš©ì„±ê³¼ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ í´ëŸ¬ìŠ¤í„°ë§, ìì›ì˜ ë™ì ì¸ í• ë‹¹ê³¼ í•´ì œ, ì´ë¯¸ì§€ ê´€ë¦¬ ë° ë³´ì•ˆ** ë“±ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ë‹¤ìˆ˜ì˜ ê°€ìƒë¨¸ì‹ ì„ ìƒì„±í•˜ì—¬ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•˜ë¯€ë¡œ, ë„¤íŠ¸ì›Œí¬ ë˜í•œ ì ì ˆí•˜ê²Œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

**Vagrantfile**

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  N = 3 # max number of worker nodes
  Ver = '1.18.4' # Kubernetes Version to install

  #=============#
  # Master Node #
  #=============#

    config.vm.define "m-k8s" do |cfg|
      cfg.vm.box = "sysnet4admin/CentOS-k8s"
      cfg.vm.provider "virtualbox" do |vb|
        vb.name = "m-k8s(github_SysNet4Admin)"
        vb.cpus = 2
        vb.memory = 3072
        vb.customize ["modifyvm", :id, "--groups", "/k8s-SgMST-1.13.1(github_SysNet4Admin)"]
      end
      cfg.vm.host_name = "m-k8s"
      cfg.vm.network "private_network", ip: "192.168.1.10"
      cfg.vm.network "forwarded_port", guest: 22, host: 60010, auto_correct: true, id: "ssh"
      cfg.vm.synced_folder "../data", "/vagrant", disabled: true 
      cfg.vm.provision "shell", path: "config.sh", args: N
      cfg.vm.provision "shell", path: "install_pkg.sh", args: [ Ver, "Main" ]
      cfg.vm.provision "shell", path: "master_node.sh"
    end

  #==============#
  # Worker Nodes #
  #==============#

  (1..N).each do |i|
    config.vm.define "w#{i}-k8s" do |cfg|
      cfg.vm.box = "sysnet4admin/CentOS-k8s"
      cfg.vm.provider "virtualbox" do |vb|
        vb.name = "w#{i}-k8s(github_SysNet4Admin)"
        vb.cpus = 1
        vb.memory = 2560
        vb.customize ["modifyvm", :id, "--groups", "/k8s-SgMST-1.13.1(github_SysNet4Admin)"]
      end
      cfg.vm.host_name = "w#{i}-k8s"
      cfg.vm.network "private_network", ip: "192.168.1.10#{i}"
      cfg.vm.network "forwarded_port", guest: 22, host: "6010#{i}", auto_correct: true, id: "ssh"
      cfg.vm.synced_folder "../data", "/vagrant", disabled: true
      cfg.vm.provision "shell", path: "config.sh", args: N
      cfg.vm.provision "shell", path: "install_pkg.sh", args: Ver
      cfg.vm.provision "shell", path: "work_nodes.sh"
    end
  end

end
```

- **5ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•  ì›Œì»¤ ë…¸ë“œì˜ ìˆ˜ë¥¼ ë³€ìˆ˜(N = 3)ë¡œ ë°›ìŒ.
- **6ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ì„ ì‚¬ìš©ìê°€ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ë³€ìˆ˜(Ver = '1.18.4')ë¡œ ì €ì¥.
- **25ë²ˆì§¸ ì¤„** : args: [ Ver, â€œMainâ€ ] ì½”ë“œë¥¼ ì¶”ê°€í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ ì •ë³´(Ver)ì™€ Mainì´ë¼ëŠ” ë¬¸ìë¥¼ install_pkg.shë¡œ ë„˜ê¹€. Ver ë³€ìˆ˜ëŠ” ê° ë…¸ë“œì— í•´ë‹¹ ë²„ì „ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ì„ ì„¤ì¹˜í•˜ê²Œ í•¨. Main ë¬¸ìëŠ” install_pkg.shì—ì„œ ì¡°ê±´ë¬¸ìœ¼ë¡œ ì²˜ë¦¬í•´ ë§ˆìŠ¤í„° ë…¸ë“œì—ë§Œ ì´ ì±…ì˜ ì „ì²´ ì‹¤í–‰ ì½”ë“œë¥¼ ë‚´ë ¤ë°›ê²Œ í•¨.
- **26ë²ˆì§¸ ì¤„/48ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„° ë…¸ë“œë¥¼ ìœ„í•œ master_node.shì™€ ì›Œì»¤ ë…¸ë“œë¥¼ ìœ„í•œ work_nodes.sh ì½”ë“œ ì¶”ê°€.



> **config.sh**ëŠ” `kubeadm`ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•œ ì‚¬ì „ ì¡°ê±´ì„ ì„¤ì •í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼.

**config.sh**

```bash
#!/usr/bin/env bash

# vim configuration 
echo 'alias vi=vim' >> /etc/profile

# swapoff -a to disable swapping
swapoff -a
# sed to comment the swap partition in /etc/fstab
sed -i.bak -r 's/(.+ swap .+)/#\1/' /etc/fstab

# kubernetes repo
gg_pkg="packages.cloud.google.com/yum/doc" # Due to shorten addr for key
cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://${gg_pkg}/yum-key.gpg https://${gg_pkg}/rpm-package-key.gpg
EOF

# Set SELinux in permissive mode (effectively disabling it)
setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

# RHEL/CentOS 7 have reported traffic issues being routed incorrectly due to iptables bypassed
cat <<EOF >  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
modprobe br_netfilter

# local small dns & vagrant cannot parse and delivery shell code.
echo "192.168.1.10 m-k8s" >> /etc/hosts
for (( i=1; i<=$1; i++  )); do echo "192.168.1.10$i w$i-k8s" >> /etc/hosts; done

# config DNS  
cat <<EOF > /etc/resolv.conf
nameserver 1.1.1.1 #cloudflare DNS
nameserver 8.8.8.8 #Google DNS
EOF
```

- **4ë²ˆì§¸ ì¤„** : vië¥¼ í˜¸ì¶œí•˜ë©´ vimì„ í˜¸ì¶œí•˜ë„ë¡ í”„ë¡œíŒŒì¼ì— ì…ë ¥.
- **7ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì„¤ì¹˜ ìš”êµ¬ ì¡°ê±´ì„ ë§ì¶”ê¸° ìœ„í•´ ìŠ¤ì™‘ë˜ì§€ ì•Šë„ë¡ ì„¤ì •.
- **9ë²ˆì§¸ ì¤„** : ì‹œìŠ¤í…œì´ ë‹¤ì‹œ ì‹œì‘ë˜ë”ë¼ë„ ìŠ¤ì™‘ë˜ì§€ ì•Šë„ë¡ ì„¤ì •.
- **12ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë¦¬í¬ì§€í„°ë¦¬ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•œ ê²½ë¡œê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ ê²½ë¡œë¥¼ ë³€ìˆ˜ë¡œ ì²˜ë¦¬.
- **13~21ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ë‚´ë ¤ë°›ì„ ë¦¬í¬ì§€í„°ë¦¬ë¥¼ ì„¤ì •í•˜ëŠ” êµ¬ë¬¸.
- **24~25ë²ˆì§¸ ì¤„** : selinuxê°€ ì œí•œì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡ permissive ëª¨ë“œë¡œ ë³€ê²½.
- **28~31ë²ˆì§¸ ì¤„** : ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µê³¼í•˜ëŠ” IPv4ì™€ IPv6ì˜ íŒ¨í‚·ì„ iptablesê°€ ê´€ë¦¬í•˜ê²Œ ì„¤ì •. íŒŒë“œ(Pod, ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ëŠ” ê°ì²´ì˜ ìµœì†Œ ë‹¨ìœ„)ì˜ í†µì‹ ì„ iptablesë¡œ ì œì–´.
- **32ë²ˆì§¸ ì¤„** : br_netfilter ì»¤ë„ ëª¨ë“ˆì„ ì‚¬ìš©í•´ ë¸Œë¦¬ì§€ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±. ì´ë•Œ ë§ˆìŠ¤ì»¤ë ˆì´ë“œ(Masquerade)ë¥¼ ì‚¬ìš©í•´ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì™€ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ ë¶„ë¦¬. IP ë§ˆìŠ¤ì»¤ë ˆì´ë“œëŠ” ì‰½ê²Œ ì„¤ëª…í•˜ë©´ ì»¤ë„ì—ì„œ ì œê³µí•˜ëŠ” NAT(Network Address Translation).
- **35~36ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ ì•ˆì—ì„œ ë…¸ë“œ ê°„ í†µì‹ ì„ ì´ë¦„ìœ¼ë¡œ í•  ìˆ˜ ìˆë„ë¡ ê° ë…¸ë“œì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ IPë¥¼ /etc/hostsì— ì„¤ì •.
- **39~42ë²ˆì§¸ ì¤„** : ì™¸ë¶€ì™€ í†µì‹ í•  ìˆ˜ ìˆê²Œ DNS ì„œë²„ë¥¼ ì§€ì •.



ğŸ“Œ**ìš©ì–´ ì •ë¦¬**

```
iptablesëŠ” ë¦¬ëˆ…ìŠ¤ì—ì„œ ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ í•„í„°ë§í•˜ê³ , íŒ¨í‚·ì„ ì „ë‹¬í•˜ê±°ë‚˜ ì°¨ë‹¨í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. (ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ì œì–´)

iptablesëŠ” ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ê·œì¹™(Rule)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·œì¹™ì€ íŒ¨í‚·ì˜ ì†ì„±ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ê³ , ì¼ì¹˜í•˜ëŠ” íŒ¨í‚·ì— ëŒ€í•´ íŠ¹ì •í•œ ë™ì‘ì„ ì·¨í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê·œì¹™ì€ ì²´ì¸(Chain)ì— ì €ì¥ë˜ì–´ ìˆìœ¼ë©°, ì²´ì¸ì€ ê·œì¹™ì˜ ì§‘í•©ì…ë‹ˆë‹¤. ì²´ì¸ì— ì €ì¥ëœ ê·œì¹™ì€ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©ë˜ë©°, ì¼ì¹˜í•˜ëŠ” ê·œì¹™ì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì •ì±…ì— ë”°ë¼ íŒ¨í‚·ì´ ì²˜ë¦¬ë©ë‹ˆë‹¤.

iptablesë¥¼ ì´ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ì œì–´í•˜ê³ , í¬ì›Œë”© ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë¼ìš°í„°ë¥¼ í†µí•´ ì „ë‹¬ë˜ëŠ” íŒ¨í‚·ì— ëŒ€í•´ì„œë„ ê·œì¹™ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


IP ë§ˆìŠ¤ì»¤ë ˆì´ë“œ(Masquerade)ëŠ” ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ ë³€í™˜(NAT, Network Address Translation)ì˜ í•œ í˜•íƒœì…ë‹ˆë‹¤.
	(ì‚¬ì„¤ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì¸í„°ë„·ì— ì ‘ì†í•  ë•Œ, ì‚¬ì„¤ IP ì£¼ì†Œë¥¼ ê³µì¸ IP ì£¼ì†Œë¡œ ë³€í™˜í•˜ì—¬ ì¸í„°ë„· ìƒì—ì„œ í†µì‹ ì´ ê°€ëŠ¥)

IP ë§ˆìŠ¤ì»¤ë ˆì´ë“œëŠ” ë„¤íŠ¸ì›Œí¬ì—ì„œ ë‚˜ê°€ëŠ” íŒ¨í‚·ì˜ ì¶œë°œì§€ IP ì£¼ì†Œë¥¼ NAT ì¥ë¹„ì—ì„œ ì„¤ì •í•œ ê³µì¸ IP ì£¼ì†Œë¡œ ë³€ê²½í•˜ì—¬ ì¸í„°ë„· ìƒì—ì„œì˜ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ ë•Œ, NAT ì¥ë¹„ì—ì„œëŠ” ë³€í™˜ëœ ì¶œë°œì§€ IP ì£¼ì†Œë¥¼ ê¸°ì–µí•˜ê³  ìˆì–´ì„œ, ì¸í„°ë„· ìƒì—ì„œì˜ ì‘ë‹µ íŒ¨í‚·ì„ NAT ì¥ë¹„ë¡œ ëŒë ¤ì¤„ ë•Œ, ë‹¤ì‹œ ì¶œë°œì§€ IP ì£¼ì†Œë¥¼ ì‚¬ì„¤ IP ì£¼ì†Œë¡œ ë³€ê²½í•˜ì—¬ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

IP ë§ˆìŠ¤ì»¤ë ˆì´ë“œëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ì‚¬ìš©ë˜ê¸°ë„ í•©ë‹ˆë‹¤. ì™¸ë¶€ë¡œë¶€í„° ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ì§ì ‘ì ì¸ ì ‘ê·¼ì„ ë§‰ê¸° ìœ„í•´ì„œ, ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ì†í•œ í˜¸ìŠ¤íŠ¸ì˜ IP ì£¼ì†Œë¥¼ ë³€í™˜í•˜ì—¬ ì™¸ë¶€ì™€ í†µì‹ í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì•ˆì „ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```







> **Install_pkg.sh**ëŠ” í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œ ê°€ìƒ ë¨¸ì‹ ì— ì„¤ì¹˜ë¼ì•¼ í•˜ëŠ” ì˜ì¡´ì„± íŒ¨í‚¤ì§€ë¥¼ ëª…ì‹œ.

**Install_pkg.sh**

```bash
#!/usr/bin/env bash

# install packages 
yum install epel-release -y
yum install vim-enhanced -y
yum install git -y

# install docker 
yum install docker -y && systemctl enable --now docker

# install kubernetes cluster 
yum install kubectl-$1 kubelet-$1 kubeadm-$1 -y
systemctl enable --now kubelet

# git clone _Book_k8sInfra.git 
if [ $2 = 'Main' ]; then
  git clone https://github.com/sysnet4admin/_Book_k8sInfra.git
  mv /home/vagrant/_Book_k8sInfra $HOME
  find $HOME/_Book_k8sInfra/ -regex ".*\.\(sh\)" -exec chmod 700 {} \;
fi
```

- **9ë²ˆì§¸ ì¤„** : ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ ë„ì»¤ë¥¼ ì„¤ì¹˜í•˜ê³  êµ¬ë™.
- **12~13ë²ˆì§¸ ì¤„** : ì¿ **ë²„ë„¤í‹°ìŠ¤ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ ì²« ë²ˆì§¸ ë³€ìˆ˜($1=Ver='1.18.4')ë¡œ ë„˜ê²¨ë°›ì€ 1.18.4 ë²„ì „ì˜ kubectl, kubelet, kubeadmì„ ì„¤ì¹˜í•˜ê³  kubeletì„ ì‹œì‘.
- **16~20ë²ˆì§¸ ì¤„** : ì´ ì±…ì˜ ì „ì²´ ì‹¤í–‰ ì½”ë“œë¥¼ ë§ˆìŠ¤í„° ë…¸ë“œì—ë§Œ ë‚´ë ¤ë°›ë„ë¡ Vagrantfileì—ì„œ ë‘ ë²ˆì§¸ ë³€ìˆ˜($2 = â€˜Mainâ€™)ë¥¼ ë„˜ê²¨ë°›ìŒ. ê·¸ë¦¬ê³  ê¹ƒì—ì„œ ì½”ë“œë¥¼ ë‚´ë ¤ë°›ì•„ ì‹¤ìŠµì„ ì§„í–‰í•  ë£¨íŠ¸ í™ˆë””ë ‰í„°ë¦¬(/root)ë¡œ ì˜®ê¹€. ë°°ì‹œ ìŠ¤í¬ë¦½íŠ¸(.sh)ë¥¼ findë¡œ ì°¾ì•„ì„œ ë°”ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•œ ìƒíƒœê°€ ë˜ë„ë¡ chmod 700ìœ¼ë¡œ ì„¤ì •.



> **master_node.sh**ëŠ” **1ê°œì˜ ê°€ìƒ ë¨¸ì‹ (m-k8s)ì„ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„° ë…¸ë“œë¡œ êµ¬ì„±**í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸. ì—¬ê¸°ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•  ë•Œ ê¼­ ì„ íƒí•´ì•¼ í•˜ëŠ” `ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(CNI, Container Network Interface)`ë„ í•¨ê»˜ êµ¬ì„±ë¨.

**master_node.sh**

```bash
#!/usr/bin/env bash

# init kubernetes 
kubeadm init --token 123456.1234567890123456 --token-ttl 0 \
--pod-network-cidr=172.16.0.0/16 --apiserver-advertise-address=192.168.1.10 

# config for master node only 
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

# config for kubernetes's network 
kubectl apply -f \
https://raw.githubusercontent.com/sysnet4admin/IaC/master/manifests/172.16_net_calico.yaml
```

- **4~5ë²ˆì§¸ ì¤„** : kubeadmì„ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì›Œì»¤ ë…¸ë“œë¥¼ ë°›ì•„ë“¤ì¼ ì¤€ë¹„ë¥¼ í•¨. ë¨¼ì € í† í°ì„ 123456.1234567890123456ìœ¼ë¡œ ì§€ì •í•˜ê³  ttl(time to live, ìœ ì§€ë˜ëŠ” ì‹œê°„)ì„ 0ìœ¼ë¡œ ì„¤ì •í•´ì„œ ê¸°ë³¸ê°’ì¸ 24ì‹œê°„ í›„ì— í† í°ì´ ê³„ì† ìœ ì§€ë˜ê²Œ í•¨. ê·¸ë¦¬ê³  ì›Œì»¤ ë…¸ë“œê°€ ì •í•´ì§„ í† í°ìœ¼ë¡œ ë“¤ì–´ì˜¤ê²Œ í•¨. ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì»¨í…Œì´ë„ˆì— ë¶€ì—¬í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ 172.16.0.0/16(172.16.0.1~172.16.255.254)ìœ¼ë¡œ ì œê³µí•˜ê³ , ì›Œì»¤ ë…¸ë“œê°€ ì ‘ì†í•˜ëŠ” API ì„œë²„ì˜ IPë¥¼ 192.168.1.10ìœ¼ë¡œ ì§€ì •í•´ ì›Œì»¤ ë…¸ë“œë“¤ì´ ìë™ìœ¼ë¡œ API ì„œë²„ì— ì—°ê²°ë˜ê²Œ í•¨.
- **8~10ë²ˆì§¸ ì¤„** : ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ í˜„ì¬ ì‚¬ìš©ìê°€ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì •ìƒì ìœ¼ë¡œ êµ¬ë™í•  ìˆ˜ ìˆê²Œ ì„¤ì • íŒŒì¼ì„ ë£¨íŠ¸ì˜ í™ˆë””ë ‰í„°ë¦¬(/root)ì— ë³µì‚¬í•˜ê³  ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì´ìš©í•  ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ì¤Œ.
- **13~14ë²ˆì§¸ ì¤„** : ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(CNI)ì¸ ìº˜ë¦¬ì½”(Calico)ì˜ ì„¤ì •ì„ ì ìš©í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±.





> **work_nodes.sh**ëŠ” **3ëŒ€ì˜ ê°€ìƒ ë¨¸ì‹ (w1-k8s, w2-k8s, w3-k8s)ì— ì¿ ë²„ë„¤í‹°ìŠ¤ ì›Œì»¤ ë…¸ë“œë¥¼ êµ¬ì„±**í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸. ë§ˆìŠ¤í„° ë…¸ë“œì— êµ¬ì„±ëœ í´ëŸ¬ìŠ¤í„°ì— ì¡°ì¸ì´ í•„ìš”í•œ ì •ë³´ê°€ ëª¨ë‘ ì½”ë“œí™”ë¼ ìˆì–´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸°ë§Œ í•˜ë©´ í¸í•˜ê²Œ ì›Œì»¤ ë…¸ë“œë¡œì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ì¡°ì¸ë¨.

**work_nodes.sh**

```bash
#!/usr/bin/env bash

# config for work_nodes only 
kubeadm join --token 123456.1234567890123456 \
             --discovery-token-unsafe-skip-ca-verification 192.168.1.10:6443
```

- **4~5ë²ˆì§¸ ì¤„** : kubeadmì„ ì´ìš©í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„° ë…¸ë“œì— ì ‘ì†. ì´ë•Œ ì—°ê²°ì— í•„ìš”í•œ í† í°ì€ ê¸°ì¡´ì— ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ìƒì„±í•œ 123456.1234567890123456ì„ ì‚¬ìš©. ê°„ë‹¨í•˜ê²Œ êµ¬ì„±í•˜ê¸° ìœ„í•´ ì¸ì¦ì„ ë¬´ì‹œí•˜ê³ , API ì„œë²„ ì£¼ì†Œì¸ 192.168.1.10ìœ¼ë¡œ ê¸°ë³¸ í¬íŠ¸ ë²ˆí˜¸ì¸ 6443ë²ˆ í¬íŠ¸ì— ì ‘ì†í•˜ë„ë¡ ì„¤ì •

ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì—ì„œ `vagrant up` ëª…ë ¹ì„ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±. ìŠˆí¼í‘¸í‹°ë¥¼ ì—´ì–´ `kubectl get nodes` ëª…ë ¹ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ë§ˆìŠ¤í„° ë…¸ë“œì™€ ì›Œì»¤ ë…¸ë“œë“¤ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ê³  ì—°ê²°ëëŠ”ì§€ í™•ì¸.



----

### íŒŒë“œ ë°°í¬ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì„± ìš”ì†Œ ì‚´í´ë³´ê¸°

**ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ì´ë£¨ëŠ” êµ¬ì„± ìš”ì†Œ**

+ kubectl, kubelet, API ì„œë²„, ìº˜ë¦¬ì½” ... 



#### ìš©ì–´ ì •ë¦¬

+ **Node** : **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ **
  +  ë…¸ë“œëŠ” **ì›Œì»¤ ë…¸ë“œ(Worker Node) ë˜ëŠ” ë¯¸ë‹ˆì–¸(Minion)**ì´ë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤. 
  + **ë…¸ë“œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ìì— ì˜í•´ ë…¸ë“œë¡œ ë“±ë¡ëœ í›„, í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ íŒŒë“œ(Pod)ë¥¼ ìŠ¤ì¼€ì¤„ë§í•˜ì—¬ ì‹¤í–‰**í•˜ê²Œ ë©ë‹ˆë‹¤. 
  + ë…¸ë“œëŠ” í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì˜ ìš´ì˜ ì²´ì œì™€ í•˜ë“œì›¨ì–´ì— ë”°ë¼ ë‹¤ì–‘í•œ ì¢…ë¥˜ê°€ ìˆìœ¼ë©°, ê° ë…¸ë“œëŠ” ìì‹ ì´ ì‹¤í–‰ ì¤‘ì¸ íŒŒë“œì— ëŒ€í•œ ê´€ë¦¬ì™€ ëª¨ë‹ˆí„°ë§ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
+ **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°(Kubernetes Cluster)** : **ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê´€ë¦¬í•˜ê³  ë°°í¬í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼**
  + ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” **ì—¬ëŸ¬ ëŒ€ì˜ ë¨¸ì‹ (ë…¸ë“œ)ì„ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ ê´€ë¦¬**í•  ìˆ˜ ìˆìœ¼ë©°, ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìŠ¤ì¼€ì¤„ë§í•˜ê³  ë¡œë“œ ë°¸ëŸ°ì‹±, ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí‚¹ ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. 
  + ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” **ë§ˆìŠ¤í„° ë…¸ë“œ(Master Node)ì™€ ì›Œì»¤ ë…¸ë“œ(Worker Node)ë¡œ êµ¬ì„±**ë©ë‹ˆë‹¤. 
    + **ë§ˆìŠ¤í„° ë…¸ë“œ** : í´ëŸ¬ìŠ¤í„° ì „ì²´ë¥¼ ê´€ë¦¬í•˜ë©°, API ì„œë²„, ìŠ¤ì¼€ì¤„ëŸ¬, ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì € ë“±ì˜ êµ¬ì„± ìš”ì†Œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
    + **ì›Œì»¤ ë…¸ë“œ** : ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ìœ¼ë¡œ, íŒŒë“œ(Pod)ë¥¼ ì‹¤í–‰í•˜ê³  ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤. 
      + ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì—°í•œ ì•„í‚¤í…ì²˜ë¥¼ ê°€ì§€ê³  ìˆì–´, ëŒ€ê·œëª¨ ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+ **ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜** : ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ê²ƒì„ í¬í•¨í•˜ëŠ” **ë…ë¦½ì ì¸ ì‹¤í–‰ í™˜ê²½ì¸ ì»¨í…Œì´ë„ˆ(Container) ì•ˆì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ íŒ¨í‚¤ì§•í•œ ê²ƒ**
  + ì»¨í…Œì´ë„ˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬, í™˜ê²½ ë³€ìˆ˜, ì‹¤í–‰ íŒŒì¼ ë° ê¸°íƒ€ ì¢…ì†ì„±ì„ í¬í•¨í•˜ë©°, í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œê³¼ëŠ” ê²©ë¦¬ë˜ì–´ ì‹¤í–‰ë©ë‹ˆë‹¤. 
  + ë”°ë¼ì„œ ë™ì¼í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ë•Œ, ì»¨í…Œì´ë„ˆ ì•ˆì— íŒ¨í‚¤ì§•ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í•­ìƒ ì¼ê´€ëœ ë™ì‘ì„ ë³´ì¥í•©ë‹ˆë‹¤. 
  + ë˜í•œ, ì»¨í…Œì´ë„ˆ ê¸°ìˆ ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹ ë¥´ê²Œ ë°°í¬í•˜ê³  í™•ì¥í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤. 
  + ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Docker, Kubernetes, Mesos ë“±ì˜ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í”Œë«í¼ì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+ **íŒŒë“œ(Pod)** : í•˜ë‚˜ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•˜ëŠ” ê°€ì¥ ì‘ì€ ë°°í¬ ë‹¨ìœ„ì…ë‹ˆë‹¤. íŒŒë“œëŠ” ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤(CPU, ë©”ëª¨ë¦¬ ë“±)ì™€ ë„¤íŠ¸ì›Œí¬, ìŠ¤í† ë¦¬ì§€ ë“±ì˜ í™˜ê²½ì„ ê³µìœ í•©ë‹ˆë‹¤. ë˜í•œ íŒŒë“œëŠ” ë…¸ë“œ(Node)ì— ë°°ì¹˜ë˜ì–´ ì‹¤í–‰ë˜ë©°, ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ íŒŒë“œëŠ” ê°€ìƒì˜ í˜¸ìŠ¤íŠ¸ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤
  + ì»¨í…Œì´ë„ˆ: íŒŒë“œ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤.
  + ë³¼ë¥¨: íŒŒë“œ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ì…ë‹ˆë‹¤. íŒŒë“œ ë‚´ì˜ ëª¨ë“  ì»¨í…Œì´ë„ˆì—ì„œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  + ë„¤íŠ¸ì›Œí¬: íŒŒë“œ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì„ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ì…ë‹ˆë‹¤. ê° íŒŒë“œëŠ” ìì²´ IP ì£¼ì†Œë¥¼ ê°€ì§€ë©°, íŒŒë“œ ê°„ í†µì‹ ì€ ì´ IP ì£¼ì†Œë¥¼ ì´ìš©í•©ë‹ˆë‹¤.




ğŸ“Œ **íŒŒë“œ(Pod)ëŠ” ë…¸ë“œ(Node)ì— ë°°ì¹˜ë˜ì–´ ì‹¤í–‰**

> ë…¸ë“œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ì†í•œ ë¬¼ë¦¬ì ì¸ í˜¸ìŠ¤íŠ¸ ì»´í“¨í„°ë‚˜ ê°€ìƒ ë¨¸ì‹ ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê° ë…¸ë“œëŠ” ìì‹ ë§Œì˜ ë¦¬ì†ŒìŠ¤(CPU, ë©”ëª¨ë¦¬ ë“±)ì™€ IP ì£¼ì†Œë¥¼ ê°€ì§€ë©°, íŒŒë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.
>
> íŒŒë“œëŠ” ë…¸ë“œ ë‚´ì—ì„œ ë³„ë„ì˜ ì´ë¦„ê³µê°„ì„ ê°€ì§€ë©°, íŒŒë“œ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆëŠ” ëª¨ë‘ ê°™ì€ ì´ë¦„ê³µê°„ì„ ê³µìœ í•©ë‹ˆë‹¤. ë˜í•œ íŒŒë“œëŠ” ë…¸ë“œ ë‚´ì—ì„œ ê³ ìœ í•œ IP ì£¼ì†Œë¥¼ ê°€ì§€ë©°, íŒŒë“œ ê°„ í†µì‹ ì€ ì´ IP ì£¼ì†Œë¥¼ ì´ìš©í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
>
> íŒŒë“œëŠ” ë…¸ë“œì— ì§ì ‘ ë°°ì¹˜ë˜ê¸° ë•Œë¬¸ì—, ë…¸ë“œì˜ ë¦¬ì†ŒìŠ¤(CPU, ë©”ëª¨ë¦¬ ë“±)ì— ë”°ë¼ íŒŒë“œì˜ ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€ê°€ ê²°ì •ë©ë‹ˆë‹¤. ë”°ë¼ì„œ íŒŒë“œë¥¼ ë°°ì¹˜í•  ë•ŒëŠ” ë…¸ë“œì˜ ë¦¬ì†ŒìŠ¤ ìƒíƒœë¥¼ ê³ ë ¤í•˜ì—¬ ì ì ˆí•œ ë…¸ë“œì— ë°°ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” íŒŒë“œë¥¼ ë°°ì¹˜í•˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬(Scheduler)ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” íŒŒë“œë¥¼ ì‹¤í–‰í•  ì ì ˆí•œ ë…¸ë“œë¥¼ ì„ íƒí•˜ì—¬ íŒŒë“œë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤.



#### ì˜¤ë¥˜ ë°œìƒ í•´ê²°

```
ì˜¤ë¥˜ : The connection to the server localhost:8080 was refused - did you specify the right host or port?

sudo apt-get update
sudo apt-get install -y ca-certificates curl

kubeadm config images pull
kubeadm init

mkdir -p $HOME/.kube
/.kubeë¡œ ì´ë™
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```



#### ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ êµ¬ì„±ìš”ì†Œ

<img src="https://user-images.githubusercontent.com/101400894/230524534-de1df7ca-71b1-46a1-881a-6de48045a8c6.png" alt="image" style="zoom:70%;" align="left"/>

**ë§ˆìŠ¤í„° ë…¸ë“œ**

0. `kubectl` : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ëª…ë ¹ì„ ë‚´ë¦¬ëŠ” ì—­í• .(API ì„œë²„ì™€ ì£¼ë¡œ í†µì‹ )
1. `API ì„œë²„` : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ì¤‘ì‹¬ ì—­í• ì„ í•˜ëŠ” í†µë¡œ. ì£¼ë¡œ **ìƒíƒœ ê°’ì„ ì €ì¥**í•˜ëŠ” **etcd**ì™€ í†µì‹ .
2. `etcd` : **êµ¬ì„± ìš”ì†Œë“¤ì˜ ìƒíƒœ ê°’ì´ ëª¨ë‘ ì €ì¥**ë˜ëŠ” ê³³. ë¶„ì‚° ì €ì¥ì´ ê°€ëŠ¥í•œ key-value ì €ì¥ì†Œ.
   + etcd
     + ë¦¬ëˆ…ìŠ¤ êµ¬ì„±ì •ë³´ë¥¼ ê°€ì§„ (etc) ì™€ distributed(í¼ëœ¨ë¦¬ë‹¤)ì˜ í•©ì„±ì–´(ì¦‰, êµ¬ì„± ì •ë³´ë¥¼ í¼ëœ¨ë ¤ ì €ì¥í•˜ê² ë‹¤ëŠ” ì˜ë¯¸)
     + ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ DBì—­í• 
3. `ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €` : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ì˜¤ë¸Œì íŠ¸ ìƒíƒœ ê´€ë¦¬. ë‹¤ì–‘í•œ ìƒíƒœ ê°’ì„ ê´€ë¦¬í•˜ëŠ” ì£¼ì²´ë“¤ì´ ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €ì— ì†Œì†ë˜ì–´ ê°ìì˜ ì—­í•  ìˆ˜í–‰.
4. `ìŠ¤ì¼€ì¤„ëŸ¬` : ë…¸ë“œì˜ ìƒíƒœì™€ ìì›, ë ˆì´ë¸”, ìš”êµ¬ ì¡°ê±´ ë“±ì„ ê³ ë ¤í•´ íŒŒë“œë¥¼ ì–´ë–¤ ì›Œì»¤ ë…¸ë“œì— ìƒì„±í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ê³  í• ë‹¹. 
   + **íŒŒë“œë¥¼ ì¡°ê±´ì— ë§ëŠ” ì›Œì»¤ ë…¸ë“œì— ì§€ì •í•˜ê³ , íŒŒë“œê°€ ì›Œì»¤ ë…¸ë“œì— í• ë‹¹ë˜ëŠ” ì¼ì •ì„ ê´€ë¦¬í•˜ëŠ” ì—­í•  ë‹´ë‹¹**.



**ì›Œì»¤ ë…¸ë“œ**

5. `kubelet` : **íŒŒë“œì˜ êµ¬ì„± ë‚´ìš©(PodSpec)ì„ ë°›ì•„ì„œ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ìœ¼ë¡œ ì „ë‹¬**í•˜ê³ , íŒŒë“œ ì•ˆì˜ ì»¨í…Œì´ë„ˆë“¤ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ëª¨ë‹ˆí„°ë§.
6. `ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„(CRI, Container Runtime Interface)` : íŒŒë“œë¥¼ ì´ë£¨ëŠ” ì»¨í…Œì´ë„ˆì˜ ì‹¤í–‰ ë‹´ë‹¹. **íŒŒë“œ ì•ˆì—ì„œ ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ì»¨í…Œì´ë„ˆê°€ ë¬¸ì œ ì—†ì´ ì‘ë™í•˜ê²Œ ë§Œë“œëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤**.
7. `íŒŒë“œ(Pod)` : **í•œ ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆ**ë¡œ ë‹¨ì¼ ëª©ì ì˜ ì¼ì„ í•˜ê¸° ìœ„í•´ì„œ ëª¨ì¸ ë‹¨ìœ„. ì¦‰, **ì›¹ ì„œë²„ ì—­í• ì„ í•  ìˆ˜ë„ ìˆê³  ë¡œê·¸ë‚˜ ë°ì´í„°ë¥¼ ë¶„ì„í•  ìˆ˜ë„ ìˆìŒ**. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ **íŒŒë“œëŠ” ì–¸ì œë¼ë„ ì£½ì„ ìˆ˜ ìˆëŠ” ì¡´ì¬**ë¼ëŠ” ì .



**ì„ íƒ ê°€ëŠ¥í•œ êµ¬ì„± ìš”ì†Œ**
0ë²ˆë¶€í„° 7ë²ˆê¹Œì§€ëŠ” ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ë°°í¬ëœ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì´ë£¨ì–´ì§€ëŠ” í†µì‹  ë‹¨ê³„ë¥¼ êµ¬ë¶„í•œ ê²ƒ. ì´ì™¸ì˜ ì„ íƒì ìœ¼ë¡œ ë°°í¬í•˜ëŠ” ê²ƒë“¤ì€ ìˆœì„œì™€ ìƒê´€ì´ ì—†ê¸° ë•Œë¬¸ì— 10ë²ˆëŒ€ë¡œ êµ¬ë¶„í•´ í‘œì‹œ.

11. `ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸` : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ í†µì‹ ì„ ìœ„í•´ì„œ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì„ ì„ íƒí•˜ê³  êµ¬ì„±í•´ì•¼ í•¨. ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì€ ì¼ë°˜ì ìœ¼ë¡œ CNI(Container Network Interface, ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤)ë¡œ êµ¬ì„±í•˜ëŠ” ë° ì—¬ê¸°ì„œëŠ” ìº˜ë¦¬ì½”(Calico)ë¥¼ ì„ íƒí•´ êµ¬ì„±í•¨.
12. `CoreDNS` : ë¹ ë¥´ê³  ìœ ì—°í•œ DNS ì„œë²„. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë„ë©”ì¸ ì´ë¦„ì„ ì´ìš©í•´ í†µì‹ í•˜ëŠ” ë° ì‚¬ìš©. ì‹¤ë¬´ì—ì„œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ì—¬ ì‚¬ìš©í•  ë•ŒëŠ” IPë³´ë‹¤ **ë„ë©”ì¸ ë„¤ì„ì„ í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•´ì£¼ëŠ” CoreDNSë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì .**



#### ì‚¬ìš©ìê°€ ë°°í¬ëœ íŒŒë“œì— ì ‘ì†í•  ë•Œ

1. kube-proxy : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” íŒŒë“œê°€ ìœ„ì¹˜í•œ ë…¸ë“œì— kube-proxyë¥¼ í†µí•´ íŒŒë“œê°€ í†µì‹ í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì„¤ì •. ì´ë•Œ ì‹¤ì œ í†µì‹ ì€ br_netfilterì™€ iptablesë¡œ ê´€ë¦¬.
2. íŒŒë“œ : ì´ë¯¸ ë°°í¬ëœ íŒŒë“œì— ì ‘ì†í•˜ê³  í•„ìš”í•œ ë‚´ìš©ì„ ì „ë‹¬ë°›ìŒ. ì´ë•Œ ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìëŠ” íŒŒë“œê°€ ì–´ëŠ ì›Œì»¤ ë…¸ë“œì— ìœ„ì¹˜í•˜ëŠ”ì§€ ì‹ ê²½ ì“°ì§€ ì•Šì•„ë„ ë¨.



ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì—¬ëŸ¬ ê°œì˜ êµ¬ì„± ìš”ì†Œë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. ê° êµ¬ì„± ìš”ì†ŒëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ íŠ¹ì •í•œ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ êµ¬ì„± ìš”ì†ŒëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
- kube-apiserver
- etcd
- kube-scheduler
- kube-controller-manager
- kubelet
- kube-proxy
- Container runtime (Docker, containerd, CRI-O ë“±)

kube-apiserverëŠ” í´ëŸ¬ìŠ¤í„°ì˜ API ì¸í„°í˜ì´ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤. etcdëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì…ë‹ˆë‹¤. kube-schedulerëŠ” íŒŒë“œë¥¼ ì ì ˆí•œ ë…¸ë“œì— í• ë‹¹í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. kube-controller-managerëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ì „ë°˜ì ì¸ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ì œì–´í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. kubeletì€ ë…¸ë“œì—ì„œ íŒŒë“œë¥¼ ì‹¤í–‰í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. kube-proxyëŠ” ì„œë¹„ìŠ¤ì™€ íŒŒë“œ ê°„ì˜ ë„¤íŠ¸ì›Œí¬ í”„ë¡ì‹œ ì—­í• ì„ í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ Container runtimeì€ íŒŒë“œ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ êµ¬ì„± ìš”ì†Œë“¤ì´ ì„œë¡œ ìƒí˜¸ì‘ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê³  íŒŒë“œë¥¼ ë°°í¬í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.



### íŒŒë“œì˜ ìƒëª…ì£¼ê¸°ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì„± ìš”ì†Œ ì‚´í´ë³´ê¸°

> íŒŒë“œì˜ **ìƒëª…ì£¼ê¸°(life cycle)**ëŠ” íŒŒë“œê°€ ìƒì„±, ìˆ˜ì •, ì‚­ì œë˜ëŠ” ê³¼ì •

<img src="https://user-images.githubusercontent.com/101400894/230528834-6f396850-6228-43da-a17a-ada4898d90c7.png" alt="image" style="zoom:67%;" ALIGN="LEFT"/><img src="https://user-images.githubusercontent.com/101400894/230534710-508843e7-aaa1-46cf-9e71-58d92a45b0d8.png" alt="image" style="zoom:50%;" />















1. `kubectl`ì„ í†µí•´ `API ì„œë²„`ì— íŒŒë“œ ìƒì„± ìš”ì²­.
2. (ì—…ë°ì´íŠ¸ê°€ ìˆì„ ë•Œë§ˆë‹¤ ë§¤ë²ˆ) API ì„œë²„ì— ì „ë‹¬ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ API ì„œë²„ëŠ” `etcd`ì— ì „ë‹¬ëœ ë‚´ìš©ì„ ëª¨ë‘ ê¸°ë¡í•´ í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœ ê°’ì„ ìµœì‹ ìœ¼ë¡œ ìœ ì§€.
3. API ì„œë²„ì— íŒŒë“œ ìƒì„±ì´ ìš”ì²­ëœ ê²ƒì„ ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €ê°€ ì¸ì§€í•˜ë©´ `ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €`ëŠ” íŒŒë“œë¥¼ ìƒì„±í•˜ê³ , ì´ ìƒíƒœë¥¼ API ì„œë²„ì— ì „ë‹¬.
4. API ì„œë²„ì— íŒŒë“œê°€ ìƒì„±ëë‹¤ëŠ” ì •ë³´ë¥¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¸ì§€. `ìŠ¤ì¼€ì¤„ëŸ¬`ëŠ” ìƒì„±ëœ íŒŒë“œë¥¼ ì–´ë–¤ ì›Œì»¤ ë…¸ë“œì— ì ìš©í• ì§€ ì¡°ê±´ì„ ê³ ë ¤í•´ ê²°ì •í•˜ê³  í•´ë‹¹ ì›Œì»¤ ë…¸ë“œì— íŒŒë“œë¥¼ ë„ìš°ë„ë¡ ìš”ì²­.
5. API ì„œë²„ì— ì „ë‹¬ëœ ì •ë³´ëŒ€ë¡œ ì›Œì»¤ ë…¸ë“œì— íŒŒë“œê°€ ì†í•´ ìˆëŠ”ì§€ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ `kubelet`ìœ¼ë¡œ í™•ì¸.
6. `kubelet`ì—ì„œ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ìœ¼ë¡œ íŒŒë“œ ìƒì„±ì„ ìš”ì²­.
7. íŒŒë“œê°€ ìƒì„±ë¨.
8. íŒŒë“œê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒíƒœê°€ ë¨.



ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì‘ì—…ì„ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•˜ëŠ” ì›Œí¬í”Œë¡œ(workflow, ì‘ì—… ì ˆì°¨) êµ¬ì¡°ê°€ ì•„ë‹ˆë¼ **ì„ ì–¸ì ì¸(declarative)** ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŒ. ì¦‰, ê° ìš”ì†Œê°€ **ì¶”êµ¬í•˜ëŠ” ìƒíƒœ(desired status)**ë¥¼ ì„ ì–¸í•˜ë©´ **í˜„ì¬ ìƒíƒœ(current status)ì™€ ë§ëŠ”ì§€ ì ê²€í•˜ê³  ê·¸ê²ƒì— ë§ì¶”ë ¤ê³  ë…¸ë ¥í•˜ëŠ” êµ¬ì¡°**ë¡œ ë˜ì–´ ìˆë‹¤ëŠ” ëœ».

ë”°ë¼ì„œ ì¶”êµ¬í•˜ëŠ” ìƒíƒœë¥¼ API ì„œë²„ì— ì„ ì–¸í•˜ë©´ ë‹¤ë¥¸ ìš”ì†Œë“¤ì´ API ì„œë²„ì— ì™€ì„œ í˜„ì¬ ìƒíƒœì™€ ë¹„êµí•˜ê³  ê·¸ì— ë§ê²Œ ìƒíƒœë¥¼ ë³€ê²½í•˜ë ¤ê³  í•¨. ì—¬ê¸°ì„œ APIëŠ” í˜„ì¬ ìƒíƒœ ê°’ì„ ê°€ì§€ê³  ìˆëŠ”ë°, ì´ê²ƒì„ ë³´ì¡´í•´ì•¼ í•´ì„œ etcdê°€ í•„ìš”. ë‹¤ë§Œ, ì—¬ê¸°ì„œ ì›Œì»¤ ë…¸ë“œëŠ” ì›Œí¬í”Œë¡œ êµ¬ì¡°ì— ë”°ë¼ ì„¤ê³„ë¨. ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ kubeletê³¼ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì„ í†µí•´ íŒŒë“œë¥¼ ìƒˆë¡œ ìƒì„±í•˜ê³  ì œê±°í•´ì•¼ í•˜ëŠ” êµ¬ì¡°ì—¬ì„œ ì„ ì–¸ì ì¸ ë°©ì‹ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ê¸°ì—ëŠ” ì–´ë ¤ì›€ì´ ìˆê¸° ë•Œë¬¸.



#### ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì„±ìš”ì†Œì˜ ê¸°ëŠ¥ ê²€ì¦í•˜ê¸°

+ **kubectl**

  + **ê¼­ ë§ˆìŠ¤í„° ë…¸ë“œì— ìœ„ì¹˜í•  í•„ìš” ì—†ìŒ**

  + kubectlì€ API ì„œë²„ë¥¼ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ëª…ë ¹ì„ ë‚´ë¦¬ë¯€ë¡œ kubectlì´ ì–´ë””ì— ìˆë”ë¼ë„ **API ì„œë²„ì˜ ì ‘ì† ì •ë³´**ë§Œ ìˆë‹¤ë©´ ì–´ëŠ ê³³ì—ì„œë“  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ëª…ë ¹ì„ ë‚´ë¦´ ìˆ˜ ìˆìŒ.

  + ex) ì›Œì»¤ë…¸ë“œì—ì„œë„ API ì„œë²„ë¥¼ í†µí•´ ëª…ë ¹ ë‚´ë¦¬ê¸°

    + w3-k8s ì—ì„œ kubectl get nodes

      + w3-k8sì—ì„œ `kubectl get nodes` ëª…ë ¹ì„ ì‹¤í–‰í•´ë„ ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œë“¤ì— ëŒ€í•œ ì •ë³´ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ. ì´ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ì •ë³´ë¥¼ kubectlì´ ì•Œì§€ ëª»í•˜ê¸° ë•Œë¬¸.
        ![img](https://velog.velcdn.com/images/leehye/post/e527ed80-7ead-49c0-b641-19e7a512d57d/image.png)

        **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ì •ë³´**(/etc/kubernetes/admin.conf)ë¥¼ ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ scp(secure copy) ëª…ë ¹ìœ¼ë¡œ w3-k8sì˜ í˜„ì¬ ë””ë ‰í„°ë¦¬(.)ì— ë°›ì•„ì˜´. ê·¸ í›„ `kubectl get nodes` ëª…ë ¹ì— ì¶”ê°€ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ ì…ë ¥ë°›ëŠ” ì˜µì…˜(`--kubeconfig`)ê³¼ ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ë°›ì•„ì˜¨ admin.confë¥¼ ì…ë ¥í•˜ê³  ì‹¤í–‰í•˜ì˜€ë”ë‹ˆ ë…¸ë“œ ì •ë³´ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨.
        ![img](https://velog.velcdn.com/images/leehye/post/f276e56f-d363-4a06-a03b-bb58406560c5/image.png)



+ **kubelet**
  + kubeletì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ **íŒŒë“œì˜ ìƒì„±ê³¼ ìƒíƒœ ê´€ë¦¬ ë° ë³µêµ¬ ë“±ì„ ë‹´ë‹¹**í•˜ëŠ” ë§¤ìš° ì¤‘ìš”í•œ êµ¬ì„± ìš”ì†Œ. ë”°ë¼ì„œ kubeletì— ë¬¸ì œê°€ ìƒê¸°ë©´ íŒŒë“œê°€ ì •ìƒì ìœ¼ë¡œ ê´€ë¦¬ë˜ì§€ ì•ŠìŒ.
  + ê¸°ëŠ¥ì„ ê²€ì¦í•˜ë ¤ë©´ ì‹¤ì œë¡œ íŒŒë“œë¥¼ ë°°í¬í•´ì•¼ í•¨. 
    + m-k8s(ë§ˆìŠ¤í„° ë…¸ë“œ)ì—ì„œ kubectl create -f ~/_Book_k8sInfra/ch3/3.1.6/nginx-pod.yaml ëª…ë ¹ìœ¼ë¡œ nginx ì›¹ ì„œë²„ íŒŒë“œë¥¼ ë°°í¬. -f ì˜µì…˜ìœ¼ë¡œ íŒŒë“œì˜ êµ¬ì„± ë‚´ìš©ì„ íŒŒì¼ë¡œ ì½ì–´ ë“¤ì—¬ 1ê°œì˜ íŒŒë“œë¥¼ ì„ì˜ì˜ ì›Œì»¤ ë…¸ë“œì— ë°°í¬í•˜ëŠ” ê²ƒ.
    + ì´í›„ íŒŒë“œê°€ ë°°í¬ëœ ì›Œì»¤ ë…¸ë“œì—ì„œ kubeletì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œëŠ” íŒŒë“œê°€ ì‚­ì œë˜ì§€ ì•ŠëŠ” ê²ƒì„ ì‹¤ìŠµìœ¼ë¡œ í™•ì¸.







## ëª…ë ¹ì–´ ì •ë¦¬

> kubectl, kubelet, API ì„œë²„, ìº˜ë¦¬ì½” ë“±ì€ ëª¨ë‘ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ì´ë£¨ëŠ” êµ¬ì„±ìš”ì†Œ

+ kubectl get nodes

  + í´ëŸ¬ìŠ¤í„°ì— ë§ˆìŠ¤í„° ë…¸ë“œì™€ ì›Œì»¤ ë…¸ë“œë“¤ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ê³  ì—°ê²° ë˜ì—ˆëŠ”ì§€ í™•ì¸
+ kubectl get pods --all-namespaces

  + ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì„± ìš”ì†Œ í™•ì¸
  + --all-namespaces : ê¸°ë³¸ ë„¤ì„ ìŠ¤í˜ì´ìŠ¤ì¸ default ì™¸ì— ëª¨ë“ ê²ƒì„ í‘œì‹œ
+ kubectl get pods -all-namespaces | grep kube-proxy
  + ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ êµ¬ì„±ìš”ì†Œì˜ í•´ì‹œì½”ë“œê¹Œì§€ í‘œí˜„
+ kubectl get pods --all-namespaces | grep coredns
  + ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  íŒŒë“œ ì¤‘ "coredns"ë¼ëŠ” ì´ë¦„ì„ í¬í•¨í•œ íŒŒë“œë¥¼ ì°¾ì•„ì„œ ì¶œë ¥í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. 
  + í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´, ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ íŒŒë“œ ì¤‘ "coredns"ë¥¼ í¬í•¨í•œ íŒŒë“œì˜ ì •ë³´ê°€ ì¶œë ¥ë©ë‹ˆë‹¤. 
  + grepì€ ì…ë ¥ëœ ë¬¸ìì—´ ì¤‘ì—ì„œ ì›í•˜ëŠ” ë¬¸ìì—´ì„ ì°¾ì•„ì„œ ì¶œë ¥í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. 
  + ìœ„ ëª…ë ¹ì–´ì—ì„œëŠ” kubectl get pods --all-namespaces ëª…ë ¹ì–´ì˜ ì¶œë ¥ ê²°ê³¼ì—ì„œ "coredns"ë¼ëŠ” ë¬¸ìì—´ì´ í¬í•¨ëœ ë¼ì¸ë§Œ ì¶”ì¶œí•˜ì—¬ ì¶œë ¥í•©ë‹ˆë‹¤.

+ scp root@192.168.1.10:/etc/kubernetes/admin.conf .

  + ```
    scp : secure copy
    /etc/kubernetes/admin.conf : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì •ë³´
    . : í˜„ì¬ ë””ë ‰í† ë¦¬
    ì¦‰ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ í˜„ì¬ ë””ë ‰í† ë¦¬ë¡œ copy í•´ì˜¨ë‹¤ëŠ” ëœ»
    ```

+ kubectl create -f ~/_Book_k8sInfra/ch3/3.1.6/nginx-pod.yaml 

  + ```
    -f : filename
    nginx-pod ìƒì„±
    ```

+ kubectl get pod

  + ë°°í¬ëœ íŒŒë“œ í™•ì¸

  + ```
    kubectl get pods -o wide
    íŒŒë“œê°€ ë°°í¬ëœ ì›Œì»¤ ë…¸ë“œ í™•ì¸(-o : output)
    ì¶œë ¥ì„ íŠ¹ì • í˜•ì‹ìœ¼ë¡œ í•´ì£¼ëŠ” ì˜µì…˜
    wide : ì œê³µë˜ëŠ” ì¶œë ¥í˜•ì‹ ì¤‘ ì¶œë ¥ì •ë³´ë¥¼ ë” ë§ì´ í•´ì£¼ëŠ” ì˜µì…˜
    ```

+ systemctl start kubelet

  + ```
    work nodeì—ì„œ kubelet ì„œë¹„ìŠ¤ë¥¼ ë³µêµ¬
    ```

+ systemctl stop kubelet

  + ```
    work nodeì—ì„œ ë°°í¬ëœ ë…¸ë“œì— ì ‘ì†í•´ kubelet ì„œë¹„ìŠ¤ë¥¼ ë©ˆì¶¤
    ```

+ kubectl delete pod nginx-pod

  + ```
    nginx-pod ì œê±°
    ```



